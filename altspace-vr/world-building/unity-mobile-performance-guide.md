---
title: AltspaceVR 移动性能指南
description: 了解如何使用各种 Unity 属性使世界在 Oculus Quest 等移动设备上性能高
ms.date: 04/20/2021
ms.topic: article
keywords: world editor， performance， oculus， quest， unity， 纹理， 浅色地图， 统计信息， 探查器， 绘图调用， altspacevr， 上传程序
ms.openlocfilehash: d5689e245c10ccb61abdd0aaa2327132d4374bb7e53a2eaec316d991b38378fb
ms.sourcegitcommit: b248ba2a6da7d669b430581fc3a1544413b2e9c1
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/11/2021
ms.locfileid: "119126948"
---
# <a name="altspacevr-mobile-performance-guide"></a>AltspaceVR 移动性能指南

## <a name="main-points"></a>**要点：**

* Oculus Quest 1 和 2 上的 **72 FPS** 是目标。
* **通过静态批处理减少绘图调用** 至关重要，旨在少于 **25 个绘图缩放**
* **每个对象一** 个材料，鼓励静态批处理 (将多材料对象拆分为单独的对象) 。
* **在大多数情况下** ，环境中的对象应设置为 **"静态** "。
* **每个场景一** 个光图，整个场景一个 2k 或 4k，每个单位大约 25 个 exel，应按对象调整光图缩放 (缩放图表) 
* 使用 **移动** 质量着色器 (即"移动/漫射"等 ) ，避免使用 Unity 标准着色器/PBR/反射探测/光探测，因为它们是繁重的操作，并且探测将添加绘制调用。
* **屏幕上少于 10 万** 个三角形
* 遮 **挡** 剔除有助于减少屏幕多边形，尽管启用遮挡剔除存在前向成本，因此使用诊断面板测量 Altspace 中帧速率的影响。
* 对于场景中 **的所有** 纹理，请使用"适用于 **Android** 的重写"，将其设置为 **RGB (A) 压缩 ASTC 6x6 块格式**。  将 Android Build 设置 压缩保留为 (文件/生成 设置/Android/纹理压缩："不要重写") ，以便浅色图不会获得 ASTC 压缩。  通过执行上述操作，并跨对象共享材料，我们尝试将场景的 Unity 包保留为大约 **10-20 MB（适用于 Android）。**

一般目标是跨设备达到可接受的帧速率 – 在 Oculus Quest 1 和 2 上，场景最好在填充场景时以 72 FPS 从所有 vantage 点运行，尽管 60-72 FPS 的范围通常是更真实的目标。

帧速率可以在 AltspaceVR 中测量，无论使用哪种设备， (AltspaceVR 应用中的 **设置/Support/Show Diagnostics Panel/FPS**) 。

可用于帮助更好地优化场景的标准 Unity 工具的下拉列表：

## <a name="stats-panelframe-debuggerprofiler"></a>**统计信息面板/帧调试器/探查器**

* 这些工具将是提高场景性能的最佳朋友。  只能在场景在编辑器中播放时引用它们，因为它们的值将不同于不播放场景时的值 (也就是说，当场景未播放时，不会发生自动静态批处理) 

* **统计信息面板** ("统计信息"下的"游戏视图"中查看) 将显示已保存的 **批处理数、SetPass** 调用数和帧速率。

    * Batches – 从当前相机的角度可见的当前绘图调用量。  **环境的批数少于 25** 个是一个不错的目标。
    * 已保存 (仅在场景正在播放) 时可见 – 通过静态批处理或 GPU 实例化减少的绘制 **调用量**
    * SetPass 调用 - 场景中不同可见材料的数量
    * 帧速率 -"游戏"视图中每秒帧数 (大致了解发生的情况;场景应始终使用 Oculus Framerate 面板在应用内、头戴显示设备中进行测试，因为 fps 读取内容将始终不同于编辑器内) 

* **帧调试器 (** 窗口/分析/帧调试器) 。  启用后，"统计信息面板"将允许你查看 GPU 正在绘制什么以创建最终图像，显示从头到后绘制的绘图列表。  它将说明绘图调用为何未与以前的绘图调用批处理 (即"此对象使用不同的材料"或"此对象使用不同的浅色图") ，是一种很好的方法，可以了解场景中发生的情况，以及某些视觉选择如何以及为何计算成本高昂。

* **探查** 器将显示游戏运行时，计算机的任何时间点使用哪些部分。 有助于确定性能存在瓶颈的地方。  例如，如果在场景中看到大量 CPU 使用率，则可能是绘图调用过多，或者如果看到 GPU 使用率过高，则可能会过度绘制 (即，呈现单个像素生成最终图像) 出现次数，这可能是由于具有多个透明图面，或者对象在未查看时被剔除。

## <a name="draw-calls-shadersmaterialsobjects"></a>**绘制着色 (/材料/对象)**

* 每次需要呈现着色器、材料或对象时，CPU 必须指示开关的 GPU (也称为"绘图调用"，并一) 。   也就是说，如果有 5 个着色器、10 个材料以及 20 个对象，则以两者中最大的者为准;你将拥有大约 20 个 drawcalls。  可以相乘绘图卡的其他功能包括：在不同的光图上设置对象，或在场景 (中具有多个实时光，也就是说，一个点光会向位于其范围) 内的每个对象添加另一个绘图，因此通常应避免场景方向光外的任何对象。  反射探测和光探测还会在它们命中的任何对象上相乘绘制调用，因此应避免它们。

* 静态 **批处理** 将在发送到 GPU (时将共享类似材料的对象批处理为单个对象，其中遮挡剔除丢弃了视图) 中的网格，因此，通过将上述示例中的所有对象设置为"静态"，将场景减少为大约 10 个绘图卡，每个材料 1 个。 

* **当对象具有** 作为另一个对象的精确材料时，会发生材料批处理，但如果对象具有多个材料，则它不会批处理具有较少材料的对象。  出于此原因 **：对象只能有 1 个材料**，并且使用多种材料的对象应拆分为每个材料单独的对象。  **可以通过纹理** 图 (纹理图集来减少材料批，以组合多个唯一对象的纹理以共享单个纹理表，以便它们都使用相同的材料) 。  如果可能，请尝试将 Atlases 的数量保持在每个场景的单个 2k 或 4k 纹理/材料。

## <a name="scene-complexity"></a>**场景复杂性**

* **几何** 图形 – 尝试将屏幕三角形保留为低于 100k 的环境。  使用 Unity 的"游戏"面板中的"统计信息"选项卡，查看从场景中的各种 vantage 点点击的三角形计数。  此类属性应包含数百个三角形范围，只有数千个三角形范围内的重要"hero"属性。 

* 虽然 Unity 的默认浅色图解决方案不会在 LOD 之间共享浅色图数据，但从技术上来说，可以使用详细网格 (级别的 **LOD**) ，因此当 LOD 在此分辨率下切换时，可能会获得光映射项目。  或者，可以使用 LOD 组组件进行简单的距离剔除，即使对象没有较低的 LOD 网格：

![Unity 中的 LOD 组窗口](images/world-building-lod-Group.png)

* 遮挡剔除将呈现的对象数减少为仅呈现在相机视图图面内的对象，并且立即可见的对象 (即从视图中遮挡的对象被剔除) 。  遮挡剔除几乎应始终为场景烘焙，并且级别应设计为支持它 (也就是说，如果具有较大的级别，则墙或大型对象可用于破坏玩家的视线，以便它们不能始终看到到级别的相反一端。  默认烘培设置应能正常工作，但可能需要收缩"最小遮挡"或"最小孔"值。  对于隔离等对象（可以在对象中通过孔查看）或透明对象，应在"静态"下拉菜单中关闭对象的"遮挡"状态，以便其后面的对象不会错误地遮挡。 

## <a name="lightmaps"></a>**浅色图**

* 理想情况下，每个 **场景只有一个光** (一个 2k 或 4k，用于所有) （如果不是）;分辨率越高的浅色图越少，分辨率越高的浅色图就越好。
* 具有多个浅色图也会影响绘图调用数，因为具有或没有浅色图的对象将位于不同的批中，其他浅色图也将位于不同的批中。
* 通常，每个单位大约 **25 个 texel** 的浅色图分辨率应 ("照明/场景设置"中设置的分辨率) 。  如果浅色图中有额外的空间，可以增加此值。
* 更改每个 **对象的"浅** 色图缩放"设置，以便为需要分辨率的对象保存分辨率。 

* **浅色图缩放** (经验法则)  
    * **前景** (可遍历级别地理) ：1 
    * **属性** (比人类小 **) ：2-3** (以避免对象上出现光图)  
    * **中 (** 可遍历区域外部的几何图形和/或大型对象（如建筑物 **) ：0.5**
    * **Vista** (/远程对象的背景 **) ：0.02** 
    * **透明表面** (如 **) ：0** (禁用"强制转换/接收阴影")  

此外，作为基线，下面是用于"屏幕门效果"环境的一些设置：

![Unity 中的照明窗口](images/world-building-lightmaps.png)

注意：如果使用这些设置，可以将光板设置为"GPU Lightmapper"，将"浅色图大小"设置为"2048"，以更快地进行预览烘培，然后备份到 CPU 和 4k 进行最终烘培。

## <a name="texture-compressionfile-size"></a>**纹理压缩/文件大小**

* 对于 Android 版本，我们尝试将 Unity 包场景大小保持在总共 10-20 MB 左右。  为此，我们跨多个对象共享通用材料，使用顶点颜色来调色对象，并设置 Android 的手动替代，使纹理使用 **ASTC 6x6** 块压缩 ，这将小于默认压缩。

* 我们未将 Android 生成设置设置为使用 ASTC 的原因是，浅色图与该压缩效果不一致 (有许多阻止项目) ，并且我们必须将浅色图设置为每次烘焙后都使用 ETC，因此，每次烘焙后更新浅色图的压缩设置一次会更容易设置所有场景纹理的重写。

![Unity 中的纹理窗口](images/world-building-texutres.png)

* 此外，将纹理设置为将三边筛选器模式与 2 个各向坐标级别一起使用可帮助它们保持高光度。

可以在改进世界性能文档中找到更多 [性能提示和技巧](improving-performance.md)。
